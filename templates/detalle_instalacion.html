{% extends "base.html" %}

{% block title %}Detalles de la Instalación{% endblock %}

{% block content %}
<div class="main-content-card">
    <div class="header-nav">
        <a href="{{ url_for('admin') }}" class="btn btn-primary">Volver al Panel de Admin</a>
    </div>

    <h1>{{ instalacion.nombre }}</h1>
    <div class="info-group">
        <strong>Cliente:</strong>
        <p>{{ instalacion.nombre_cliente }}</p>
    </div>
    <div class="info-group">
        <strong>Descripción de la Solicitud:</strong>
        <p>{{ instalacion.descripcion }}</p>
    </div>
    <div class="info-group">
        <strong>Técnico Asignado:</strong>
        <p>{{ instalacion.tecnico_asignado or 'N/A' }}</p>
    </div>
    <div class="info-group">
        <strong>Estado de la Tarea:</strong>
        <span class="card-status status-{{ instalacion.estado_tarea|lower|replace(' ', '-') }}">
            {{ instalacion.estado_tarea or 'No Asignado' }}
        </span>
    </div>

    {% if instalacion.estado_tarea == 'Completada' %}
<h2 class="form-section-title mt-6">Reporte de Finalización</h2>
<div class="space-y-4">
    <div class="info-group">
        <strong>Descripción del Trabajo:</strong>
        <p>{{ instalacion.descripcion_final or 'Sin descripción' }}</p>
    </div>
    <div class="info-group">
        <strong>Número de Serie:</strong>
        <p>{{ instalacion.numero_serie or 'N/A' }}</p>
    </div>
    <div class="info-group">
        <strong>Ubicación Final (GPS):</strong>
        <p>{{ instalacion.ubicacion_gps_final or 'N/A' }}</p>
    </div>
    <div class="info-group">
        <strong>Fecha de Finalización:</strong>
        <p>{{ instalacion.fecha_completado.strftime('%d/%m/%Y %H:%M') if instalacion.fecha_completado else 'N/A' }}</p>
    </div>
   {% if instalacion.foto_adjunta %}
    <div class="info-group">
        <strong>Fotos de la Instalación:</strong>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
        {% set fotos = instalacion.foto_adjunta | from_json %}
        {% for foto in fotos %}
            <img src="{{ url_for('static', filename=foto) }}" alt="Foto de la instalación" style="max-width: 100%; height: auto; border-radius: 8px;">
        {% endfor %}
        </div>
    </div>
{% else %}
    <div class="info-group">
        <strong>Foto de la Instalación:</strong>
        <p>No hay foto adjunta.</p>
    </div>
{% endif %}
</div>
{% else %}


    <h2 class="form-section-title mt-6">Detalles de la Solicitud</h2>
    <div class="space-y-4">
        <div class="info-group">
            <strong>Código de Cliente:</strong>
            <p>{{ instalacion.codigo_cliente }}</p>
        </div>
        <div class="info-group">
            <strong>Teléfono:</strong>
            <p>{{ instalacion.telefono_cliente }}</p>
        </div>
        <div class="info-group">
            <strong>Referencia del Domicilio:</strong>
            <p>{{ instalacion.referencia }}</p>
        </div>
        <div class="info-group">
            <strong>Ruta y Caja NAP:</strong>
            <p>{{ instalacion.ruta_caja_nap }}</p>
        </div>
        <div class="info-group">
            <strong>Ubicación inicial (GPS):</strong>
            <p>{{ instalacion.ubicacion_gps }}</p>
        </div>
        {% if instalacion.imagen_url %}
        <div class="info-group">
            <strong>Imagen de Referencia:</strong>
            <img src="{{ url_for('static', filename='uploads/' + instalacion.imagen_url.split('/')[-1]) }}" alt="Imagen de la instalación" style="max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px;">
        </div>
        {% endif %}
    </div>
    {% endif %}
    
</div>
{% endblock %}